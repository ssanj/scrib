<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Scrib</title>
  <link rel="stylesheet" href="css/bulma.min.css">
  <link rel="stylesheet" href="css/md.css">
  <link rel="stylesheet" href="css/scrib.css">
  <script src="js/scrib-save.js"></script>
  <script src="js/ports.js"></script>
  <script src="js/ui.js"></script>
</head>
<body>
  <div id="myapp"></div>
  <script>

    const appEditKey = 'scrib.edit';
    const appApiKey  = 'scrib.api.key';

    const app = Elm.Save.init({
      flags: initLoad(appEditKey),
      node: document.getElementById('myapp')
    });

    app.ports.scribMessage.subscribe(function(action){
      portActions(action, app.ports.jsMessage.send);
    });


    function initLoad(appKey) {
      const storedData     = localStorage.getItem(appKey);
      //TODO: we should try/catch here.
      const noteForEditing = storedData ? JSON.parse(storedData) : null;
      const apiKey         = JSON.parse(localStorage.getItem(appApiKey));
      return { "note": noteForEditing , ...apiKey};
    }

    document.addEventListener('DOMContentLoaded', () => burgerMenu(document));
  </script>

</body>
</html>