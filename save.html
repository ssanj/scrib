<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Scrib</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.0/css/bulma.min.css">
  <link rel="stylesheet" href="md.css">
  <script src="scrib-save.js"></script>
  <script src="ports.js"></script>
</head>

<body>
  <div id="myapp"></div>
  <script>

    const appEditKey = 'scrib.edit';
    const appApiKey  = 'scrib.api.key';

    const app = Elm.Save.init({
      flags: initLoad(appEditKey),
      node: document.getElementById('myapp')
    });

    app.ports.scribMessage.subscribe(function(action){
      portActions(action, app.ports.jsMessage.send);
    });


    function initLoad(appKey) {
      const storedData     = localStorage.getItem(appKey);
      //TODO: we should try/catch here.
      const noteForEditing = storedData ? JSON.parse(storedData) : null;
      const apiKey         = localStorage.getItem(appApiKey);
      return { "note": noteForEditing , "apiKey": apiKey};
    }
  </script>
</body>
</html>